# This is a basic workflow to help you get started with Actions

name: Trigger Error

on: [workflow_dispatch]

defaults:
  run:
    shell: powershell

env:
  workflowDepth: 1

jobs:
  build:
    name: ðŸš€ Build App
    #runs-on: ubuntu-latest
    runs-on: [ windows-latest ]
    steps:
      - name: Checkout source
        uses: actions/checkout@v2
        
      - name: Add Android platform
        run: cordova platform add android@11.0.0
        
      - name: Runs on job failure
        if: ${{ failure() }}
        run: |
          
          $Cred = Get-Credential
          $Url = "https://server.contoso.com:8089/services/search/jobs/export"
          $Body = @{
              search = "search index=_internal | reverse | table index,host,source,sourcetype,_raw"
              output_mode = "csv"
              earliest_time = "-2d@d"
              latest_time = "-1d@d"
          }
          Invoke-RestMethod -Method 'Post' -Uri $url -Credential $Cred -Body $body -OutFile output.csv
           
